<!--
  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘         CHATBOT WIDGET â€“ Facultad de Ciencias UNICA          â•‘
  â•‘                                                               â•‘
  â•‘  INSTRUCCIONES DE USO:                                        â•‘
  â•‘  1. Copia el bloque <style> dentro del <head> de index.html  â•‘
  â•‘  2. Copia el HTML del widget antes del </body>               â•‘
  â•‘  3. Copia el <script> antes del </body>                      â•‘
  â•‘  4. Reemplaza la funciÃ³n fcCallAI() con tu modelo/agente     â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chatbot Widget â€“ Demo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

  <!-- â”€â”€â”€ VARIABLES CSS (ya las tienes en style.css, no duplicar) â”€â”€â”€ -->
  <style>
    :root {
      --primary:   #0d048d;
      --secondary: #d0f1fe;
      --accent:    #d7b03a;
      --white:     #ffffff;
      --text-dark: #1a1a1a;
    }
    body { background: #f0f4ff; } /* solo para el demo */
  </style>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BLOQUE 1 â”€ ESTILOS DEL WIDGET
       Pega esto dentro de <head> en tu index.html
       (o al final de style.css)
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <style id="chatbot-styles">
    /* â”€â”€ Burbuja flotante â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #fcBubble {
      position: fixed; bottom: 28px; right: 28px;
      width: 56px; height: 56px; border-radius: 50%;
      background: var(--primary); border: none;
      box-shadow: 0 6px 24px rgba(13,4,141,.4);
      cursor: pointer; z-index: 1050;
      display: flex; align-items: center; justify-content: center;
      transition: transform .25s, box-shadow .25s;
    }
    #fcBubble:hover { transform: scale(1.1); box-shadow: 0 10px 32px rgba(13,4,141,.55); }
    #fcBubble i { font-size: 22px; color: #fff; }
    #fcBubble .fc-dot {
      position: absolute; top: 5px; right: 5px;
      width: 11px; height: 11px; border-radius: 50%;
      background: var(--accent); border: 2px solid #fff;
      animation: fcPulse 2s infinite;
    }
    @keyframes fcPulse {
      0%,100% { transform: scale(1); opacity: 1; }
      50%      { transform: scale(1.4); opacity: .65; }
    }

    /* â”€â”€ Ventana del chat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #fcWindow {
      position: fixed; bottom: 96px; right: 28px;
      width: 355px; max-width: calc(100vw - 36px);
      height: 510px; max-height: calc(100vh - 130px);
      background: #fff; border-radius: 18px;
      box-shadow: 0 20px 60px rgba(13,4,141,.18);
      display: flex; flex-direction: column; overflow: hidden;
      z-index: 1049;
      /* AnimaciÃ³n cerrado â†’ abierto */
      transform: scale(.85) translateY(28px);
      opacity: 0; pointer-events: none;
      transition: transform .3s cubic-bezier(.34,1.56,.64,1), opacity .25s;
    }
    #fcWindow.fc-open {
      transform: scale(1) translateY(0);
      opacity: 1; pointer-events: all;
    }

    /* Header */
    .fc-header {
      background: var(--primary); padding: 13px 16px;
      display: flex; align-items: center; gap: 10px; flex-shrink: 0;
    }
    .fc-av {
      width: 36px; height: 36px; border-radius: 50%;
      background: var(--accent);
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 13px; color: #fff; flex-shrink: 0;
    }
    .fc-hinfo h6 { margin: 0; color: #fff; font-size: .88rem; font-weight: 600; }
    .fc-hinfo small { color: var(--secondary); font-size: .7rem; }
    .fc-x {
      margin-left: auto; background: none; border: none;
      color: rgba(255,255,255,.6); font-size: 19px;
      cursor: pointer; line-height: 1; padding: 0 2px;
      transition: color .2s;
    }
    .fc-x:hover { color: #fff; }

    /* Mensajes */
    .fc-body {
      flex: 1; overflow-y: auto; padding: 14px;
      display: flex; flex-direction: column; gap: 10px;
      background: #f5f7ff; scroll-behavior: smooth;
    }
    .fc-body::-webkit-scrollbar { width: 3px; }
    .fc-body::-webkit-scrollbar-thumb { background: #c3cfe8; border-radius: 4px; }

    .fc-msg { display: flex; gap: 6px; align-items: flex-end; }
    .fc-msg.fc-bot  { flex-direction: row; }
    .fc-msg.fc-user { flex-direction: row-reverse; }
    .fc-mav {
      width: 24px; height: 24px; border-radius: 50%;
      background: var(--primary);
      display: flex; align-items: center; justify-content: center;
      font-size: 9px; font-weight: 700; color: #fff; flex-shrink: 0;
    }
    .fc-bbl {
      max-width: 78%; padding: 8px 13px;
      border-radius: 15px; font-size: .83rem; line-height: 1.5;
    }
    .fc-bot  .fc-bbl {
      background: #fff; color: var(--text-dark);
      border-bottom-left-radius: 3px;
      box-shadow: 0 2px 8px rgba(0,0,0,.07);
    }
    .fc-user .fc-bbl {
      background: var(--primary); color: #fff;
      border-bottom-right-radius: 3px;
    }

    /* Typing */
    .fc-typing { display: flex; gap: 4px; padding: 3px 0; align-items: center; }
    .fc-typing span {
      width: 6px; height: 6px; border-radius: 50%;
      background: #9aa5c4; animation: fcBounce .9s infinite;
    }
    .fc-typing span:nth-child(2) { animation-delay: .15s; }
    .fc-typing span:nth-child(3) { animation-delay: .30s; }
    @keyframes fcBounce {
      0%,60%,100% { transform: translateY(0); }
      30%          { transform: translateY(-6px); }
    }

    /* Chips */
    .fc-chips {
      display: flex; flex-wrap: wrap; gap: 5px;
      padding: 8px 14px; background: #fff;
      border-top: 1px solid #e8eef8;
    }
    .fc-chip {
      font-size: .71rem; padding: 3px 10px; border-radius: 20px;
      border: 1.5px solid var(--primary); color: var(--primary);
      background: none; cursor: pointer; font-family: inherit;
      transition: background .2s, color .2s;
    }
    .fc-chip:hover { background: var(--primary); color: #fff; }

    /* Input */
    .fc-foot {
      padding: 10px 13px; border-top: 1px solid #e8eef8;
      background: #fff; display: flex; gap: 7px; align-items: center; flex-shrink: 0;
    }
    .fc-foot input {
      flex: 1; border: 1.5px solid #cdd6ee; border-radius: 22px;
      padding: 8px 14px; font-size: .83rem; outline: none;
      transition: border .2s; font-family: inherit;
    }
    .fc-foot input:focus { border-color: var(--primary); }
    .fc-sendbtn {
      width: 36px; height: 36px; border-radius: 50%;
      background: var(--primary); border: none; flex-shrink: 0;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; transition: background .2s, transform .15s;
    }
    .fc-sendbtn:hover   { background: #1a0fb3; transform: scale(1.08); }
    .fc-sendbtn:disabled { background: #aab; cursor: not-allowed; transform: none; }
    .fc-sendbtn i { color: #fff; font-size: 15px; }
  </style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     BLOQUE 2 â”€ HTML DEL WIDGET
     Pega esto justo ANTES del </body> en tu index.html
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- BotÃ³n burbuja -->
<button id="fcBubble" title="Asistente virtual">
  <span class="fc-dot"></span>
  <i class="bi bi-chat-dots-fill"></i>
</button>

<!-- Ventana -->
<div id="fcWindow">

  <div class="fc-header">
    <div class="fc-av">FC</div>
    <div class="fc-hinfo">
      <h6>Asistente â€“ Fac. Ciencias</h6>
      <small>â¬¤&nbsp; En lÃ­nea Â· UNICA, Ica</small>
    </div>
    <button class="fc-x" id="fcClose"><i class="bi bi-x-lg"></i></button>
  </div>

  <div class="fc-body" id="fcBody"></div>

  <div class="fc-chips">
    <button class="fc-chip" data-q="Â¿CuÃ¡les son los programas acadÃ©micos?">Programas</button>
    <button class="fc-chip" data-q="Â¿QuiÃ©n es el decano?">Decano</button>
    <button class="fc-chip" data-q="Â¿CuÃ¡ntos estudiantes hay?">Estudiantes</button>
    <button class="fc-chip" data-q="Â¿QuÃ© laboratorios tienen?">Laboratorios</button>
    <button class="fc-chip" data-q="Â¿CuÃ¡l es la historia de la facultad?">Historia</button>
  </div>

  <div class="fc-foot">
    <input type="text" id="fcInput" placeholder="Escribe tu preguntaâ€¦" autocomplete="off">
    <button class="fc-sendbtn" id="fcSend" disabled>
      <i class="bi bi-send-fill"></i>
    </button>
  </div>

</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     BLOQUE 3 â”€ LÃ“GICA DEL WIDGET
     Pega esto justo ANTES del </body>, DESPUÃ‰S de los otros scripts
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
(function () {

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     ğŸ“Œ PUNTO DE INTEGRACIÃ“N
     Reemplaza el cuerpo de esta funciÃ³n con la llamada
     a tu modelo de IA o agente preferido.

     ParÃ¡metros:
       â€¢ messages  â†’ Array con el historial completo de la conversaciÃ³n
                     Formato: [{ role: 'user'|'assistant', content: 'texto' }, ...]
                     El ÃšLTIMO elemento es el mensaje nuevo del usuario.

     Debe retornar:
       â€¢ Un string con la respuesta del asistente.

     Ejemplos de integraciÃ³n:
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     // Anthropic Claude (requiere proxy/backend):
     const res = await fetch('/api/chat', {
       method: 'POST',
       headers: { 'Content-Type': 'application/json' },
       body: JSON.stringify({ messages })
     });
     const data = await res.json();
     return data.reply;

     // OpenAI ChatGPT (requiere proxy/backend):
     const res = await fetch('/api/openai', {
       method: 'POST',
       headers: { 'Content-Type': 'application/json' },
       body: JSON.stringify({ messages })
     });
     const data = await res.json();
     return data.choices[0].message.content;

     // n8n / Make webhook:
     const res = await fetch('https://tu-webhook.n8n.cloud/webhook/chat', {
       method: 'POST',
       headers: { 'Content-Type': 'application/json' },
       body: JSON.stringify({ messages })
     });
     const data = await res.json();
     return data.output;

     // Respuesta estÃ¡tica de prueba (eliminar en producciÃ³n):
     return 'Hola, soy el asistente. [Conecta tu modelo aquÃ­]';
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  async function fcCallAI(messages) {

    // â–¼â–¼â–¼ ESCRIBE TU CÃ“DIGO DE INTEGRACIÃ“N AQUÃ â–¼â–¼â–¼



    // â–²â–²â–² FIN DE TU CÃ“DIGO DE INTEGRACIÃ“N â–²â–²â–²

    // Respuesta de prueba mientras integras (eliminar luego)
    return 'Â¡Hola! AÃºn no tengo un modelo conectado. Reemplaza la funciÃ³n <code>fcCallAI()</code> en el script con tu integraciÃ³n.';
  }
  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */


  /* â”€â”€ Estado â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  const history = [];
  let busy     = false;
  let greeted  = false;

  /* â”€â”€ Refs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  const bubble   = document.getElementById('fcBubble');
  const win      = document.getElementById('fcWindow');
  const closeBtn = document.getElementById('fcClose');
  const body     = document.getElementById('fcBody');
  const input    = document.getElementById('fcInput');
  const sendBtn  = document.getElementById('fcSend');

  /* â”€â”€ Toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  bubble.addEventListener('click', () => {
    win.classList.toggle('fc-open');
    if (win.classList.contains('fc-open') && !greeted) {
      appendBot('Â¡Hola! ğŸ‘‹ Soy el asistente de la <strong>Facultad de Ciencias â€“ UNICA</strong>. Â¿En quÃ© puedo ayudarte?');
      greeted = true;
    }
  });
  closeBtn.addEventListener('click', () => win.classList.remove('fc-open'));

  /* â”€â”€ Input â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  input.addEventListener('input', () => {
    sendBtn.disabled = !input.value.trim() || busy;
  });
  input.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); if (!sendBtn.disabled) send(); }
  });
  sendBtn.addEventListener('click', send);

  document.querySelectorAll('.fc-chip').forEach(c =>
    c.addEventListener('click', () => { input.value = c.dataset.q; send(); })
  );

  /* â”€â”€ Enviar mensaje â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  async function send() {
    const text = input.value.trim();
    if (!text || busy) return;
    input.value = '';
    sendBtn.disabled = true;
    appendUser(text);
    history.push({ role: 'user', content: text });
    busy = true;
    const typingEl = appendTyping();

    try {
      const reply = await fcCallAI([...history]);
      typingEl.remove();
      appendBot(reply);
      history.push({ role: 'assistant', content: reply });
    } catch (err) {
      typingEl.remove();
      appendBot('Hubo un error de conexiÃ³n. Por favor intenta de nuevo.');
      console.error('[fcChatbot]', err);
    }

    busy = false;
    sendBtn.disabled = !input.value.trim();
  }

  /* â”€â”€ Renderizado â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function appendBot(html) {
    const d = document.createElement('div');
    d.className = 'fc-msg fc-bot';
    d.innerHTML = `<div class="fc-mav">FC</div><div class="fc-bbl">${html}</div>`;
    body.appendChild(d); scroll();
  }
  function appendUser(text) {
    const d = document.createElement('div');
    d.className = 'fc-msg fc-user';
    d.innerHTML = `<div class="fc-bbl">${esc(text)}</div>`;
    body.appendChild(d); scroll();
  }
  function appendTyping() {
    const d = document.createElement('div');
    d.className = 'fc-msg fc-bot';
    d.innerHTML = `<div class="fc-mav">FC</div><div class="fc-bbl"><div class="fc-typing"><span></span><span></span><span></span></div></div>`;
    body.appendChild(d); scroll();
    return d;
  }
  function scroll() { body.scrollTop = body.scrollHeight; }
  function esc(s) {
    return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br>');
  }

})();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
